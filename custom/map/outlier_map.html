<!doctype html>
<html lang="en">

	<head>
		
		<!-- Info -->
		<meta charset="utf-8">
		<title>Outlier Map</title>
		<meta name="description" content="Outlier Map for Thesis Defense">
		<meta name="author" content="Richard Wen">
		
		<!-- CSS -->
		<link rel="stylesheet" href="../../leaflet/leaflet.css">
		<style>
			.legend {
				margin-top: 1px
				line-height: 18px;
				color: #555;
				background: #ffffff;
				padding: 10px;
				border-radius: 5px;
				-moz-border-radius: 5px;
				-webkit-border-radius: 5px;
				-webkit-box-shadow: 0px 0px 10px 3px #888888;
				-moz-box-shadow: 0px 0px 10px 3px #888888;
				box-shadow: 0px 0px 10px 3px #888888;
			}
			.legend i {
				width: 12px;
				height: 12px;
				float: left;
				margin-right: 3px;
				margin-top: 3px;
				opacity: 0.7;
				border: 1px solid #252525;
			}
			.circle {
				border-radius: 50%;
			}
		</style>
		
	</head>
	
	<body>
	
		<!-- Create webmap div and source lib and data-->
		<div id="webmap" style="height: 98vh;"></div>
		<script src="../../leaflet/leaflet.js"></script>
		<script src="outliers.geojson"></script>
		
		<!-- Webmap JS Script -->
		<script>
		
			// Setup leaflet map
			var southWest = L.latLng(42.84, -79.99),
				northEast = L.latLng(44.318, -78.3),
				bounds = L.latLngBounds(southWest, northEast);
			var webmap = L.map('webmap', {
				center: bounds.getCenter(),
				zoom: 9,
				maxBounds: bounds,
				maxBoundsViscosity: 1.0});
			L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
				minZoom: 9,
				maxZoom: 20,
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			}).addTo(webmap);
			
			// Popups
			function onEachFeature(feature, layer) {
				// does this feature have a property named popupContent?
				if (feature.properties && feature.properties.popupContent) {
					layer.bindPopup(feature.properties.popupContent);
				}
			};
			
			// Style data points
			function getColor(d) {
				return d == "hospital" ? "#7fc97f" :
					   d == "school" ? "#ffff99" :
					   "#ffffff"
			}
			function getStyle(feature) {
				return {
					radius: 7,
					fillColor: getColor(feature.properties.type),
					color: "#252525",
					weight: 1,
					opacity: 1,
					fillOpacity: 1
				}
			}
			
			// Create data points with popups
			L.geoJson(data, {
				onEachFeature: onEachFeature,
				pointToLayer: function (feature, latlng){
					var txt = "<b>ID: </b>" + feature.properties.osm_id + "<br>"
						+ "<b>Name: </b>" + feature.properties.name + "<br>"
						+ "<b>Class: </b>" + feature.properties.type + "<br>"
					if (feature.properties.type == "hospital") {
						txt += "<b>1. Nearest Secondary Road: </b>" + Math.round(feature.properties.near_secon) + " meters<br>"
							+ "<b>2. Nearest Railway: </b>" + Math.round(feature.properties.near_rail) + " meters<br>"
							+ "<b>3. Area: </b>" + Math.round(feature.properties.area) + " meters<br>"
							+ "<b>4. Nearest Police Station: </b>" + Math.round(feature.properties.near_polic) + " meters<br>"
							+ "<b>5. Nearest Tertiary Road: </b>" + Math.round(feature.properties.near_terti) + " meters<br>"
					} else if (feature.properties.type == "school") {
						txt += "<b>1. Nearest Bus Stop: </b>" + Math.round(feature.properties.near_bus_s) + " meters<br>"
							+ "<b>2. Nearest Fuel Station: </b>" + Math.round(feature.properties.near_fuel) + " meters<br>"
							+ "<b>3. Nearest Subway: </b>" + Math.round(feature.properties.near_subwa) + " meters<br>"
							+ "<b>4. Nearest Turning Circle: </b>" + Math.round(feature.properties.near_turni) + " meters<br>"
							+ "<b>5. Nearest Disused Road: </b>" + Math.round(feature.properties.near_disus) + " meters<br>"
					}
					return L.circleMarker(latlng, getStyle(feature)).bindPopup(txt);
				}
			}).addTo(webmap);
			
			// Create legend for data points
			function getLabel(d) {
				return d == "fire_station" ? "Fire Station" :
					   d == "fuel" ? "Fuel Station" :
					   d == "hospital" ? "Hospital" :
					   d == "library" ? "Library" :
					   d == "police" ? "Police Station" :
					   d == "school" ? "School" :
					   d == "townhall" ? "Townhall" :
					   d == "university" ? "University" :
					   "Unknown"
			}
			var legend = L.control({position: 'bottomright'});
			legend.onAdd = function (map) {
				var div = L.DomUtil.create('div', 'info legend'),
					labels = ["hospital", "school"];

				// loop through our density intervals and generate a label with a colored square for each interval
				for (var i = 0; i < labels.length; i++) {
					div.innerHTML +=
						'<i class= "circle" style="background:' + getColor(labels[i]) + '"></i> ' +
						(getLabel(labels[i]) ? getLabel(labels[i]) + '<br>' : '+');
			}

				return div;
			};

			legend.addTo(webmap);
			
		</script>
	</body>
	
</html>